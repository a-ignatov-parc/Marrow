(function(t,e){"function"==typeof define&&define.amd?define(["underscore","backbone"],function(i,n){return e(i||t._,n||t.Backbone)}):e(_,Backbone)})(this,function(t,e){function i(){return(0|65536*(1+Math.random())).toString(16).substring(1)}function n(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}return e.LocalStorage=window.Store=function(t){this.name=t;var e=this.localStorage().getItem(this.name);this.records=e&&e.split(",")||[]},t.extend(e.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(t){return t.id||(t.id=n(),t.set(t.idAttribute,t.id)),this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),this.records.push(""+t.id),this.save(),this.find(t)},update:function(e){return this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),t.include(this.records,""+e.id)||this.records.push(""+e.id),this.save(),this.find(e)},find:function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t.id))},findAll:function(){return t(this.records).chain().map(function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t))},this).compact().value()},destroy:function(e){return e.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+e.id),this.records=t.reject(this.records,function(t){return t===""+e.id}),this.save(),e)},localStorage:function(){return localStorage},jsonData:function(t){return t&&JSON.parse(t)},_clear:function(){var e=this.localStorage(),i=RegExp("^"+this.name+"-");e.removeItem(this.name),t.chain(e).keys().filter(function(t){return i.test(t)}).each(function(t){e.removeItem(t)})},_storageSize:function(){return this.localStorage().length}}),e.LocalStorage.sync=window.Store.sync=e.localSync=function(t,i,n){var o,s,a=i.localStorage||i.collection.localStorage,r=$.Deferred&&$.Deferred();try{switch(t){case"read":o=void 0!=i.id?a.find(i):a.findAll();break;case"create":o=a.create(i);break;case"update":o=a.update(i);break;case"delete":o=a.destroy(i)}}catch(l){s=l.code===DOMException.QUOTA_EXCEEDED_ERR&&0===a._storageSize()?"Private browsing is unsupported":l.message}return o?(i.trigger("sync",i,o,n),n&&n.success&&("0.9.10"===e.VERSION?n.success(i,o,n):n.success(o)),r&&r.resolve(o)):(s=s?s:"Record Not Found",i.trigger("error",i,s,n),n&&n.error&&("0.9.10"===e.VERSION?n.error(i,s,n):n.error(s)),r&&r.reject(s)),n&&n.complete&&n.complete(o),r&&r.promise()},e.ajaxSync=e.sync,e.getSyncMethod=function(t){return t.localStorage||t.collection&&t.collection.localStorage?e.localSync:e.ajaxSync},e.sync=function(t,i,n){return e.getSyncMethod(i).apply(this,[t,i,n])},e.LocalStorage});